<div class="right" id="controls">
  <% if @current_user.admin? -%>
    <%= link_to t( 'edit' ), edit_user_path(@user), :class => 'edit-user', :title => t( '.edit_user' ) %> |
    <% unless @user.enabled? -%>
      <%= link_to t( 'enable' ), toggle_user_path, :confirm => t( '.really_enable_user_x', :user => @user.username ), :method => :post, :class => 'enable', :title => t( '.enable_user' ) -%> |
    <% else -%>
      <%= link_to t( 'disable' ), toggle_user_path, :confirm => t( '.really_disable_user_x', :user => @user.username ), :method => :post, :class => 'disable', :title => t( '.disable_user' ) -%> |
    <% end -%>
    <% if @user.locked? -%>
      <%= link_to t( '.unlock' ), unlock_user_path, :confirm => t( '.really_unlock_user_x', :user => @user.username ), :method => :post, :class => 'unlock', :title => t( '.unlock_user' ) -%> |
    <% end -%>
  <% elsif @current_user.id == @user.id -%>
    <%= link_to t( '.edit' ), edit_user_path, :class => 'edit-user', :title => t(  '.edit_user' ) %> |
  <% end -%>
  <%= link_to t( 'back' ), :back, :class => 'back', :title => t( 'back' ) -%>
</div>

<%#= image_tag "avatar.gif", :alt => "", :class => "profile-avatar" %>
<%= user_avatar @user %>
<h2 style="display: inline;"<%= @user.enabled? ? '' : ' class="disabled"' -%>><%= h @user.username -%></h2>

<table class="profile <%= @user.enabled? ? '' : 'disabled' -%>">
  <tr>
    <td class="field"><%= t 'users.users.first_name' %>:</td><td class="value"><%=h @user.first_name -%></td>
    <td class="field"><%= t 'users.users.last_name' %>:</td><td class="value"><%=h @user.last_name -%></td>
  </tr>
  <tr>
    <td class="field"><%= t 'email' %>:</td><td class="value"><%=h @user.email -%></td>
    <td class="field"><%= t 'users.users.timezone' %>:</td><td class="value"><%=h @user.time_zone -%></td>
  </tr>
  <tr>
    <td class="field"><%= t 'users.users.last_login' %>:</td><td class="value"><%= nice_date @user.last_login_at unless @user.last_login_at.nil? -%></td>
    <td class="field"><%= t 'users.users.last_login_ip' %>:</td><td class="value"><%=h @user.last_login_ip -%></td>
  </tr>
  <% unless @user.enabled? -%>
  <tr>
    <td class="field"><%= t 'users.users.disabled_at' %>:</td><td class="value"><%= nice_date @user.disabled_at -%></td>
    <td></td><td></td>
  </tr>
  <% end -%>
</table>

<% unless @recently_assigned_to.empty? -%>
  <h3 class="toggle" id="assigned-to-toggle"><%= t '.recently_assigned_tickets' %></h3>
  <div id="assigned-to-listing">
  <table class="listing" cellspacing="0">
  <thead>
    <tr class="header">
      <th><%= t 'tickets.ticket_number' %></th>
      <th><%= t 'tickets.title' %></th>
      <th><%= t 'tickets.group' %></th>
      <th><%= t 'tickets.status' %></th>
      <th><%= t 'tickets.contact' %></th>
      <th><%= t 'tickets.last_activity' %></th>
    </tr>
  </thead>
  <tbody>
    <% @recently_assigned_to.each do |ticket| %>
    <tr class="<%= cycle("list-line-odd", "list-line-even", :name => "active") %>">
      <% if ticket.priority.standard? -%>
        <td><%= link_to ticket.id, ticket, { :title => "Ticket ##{ticket.id}: #{ticket.priority.name} priority", :class => "#{ticket.priority.name.downcase}" } -%></td>
      <% else -%>
        <td><%= link_to ticket.id, ticket, { :title => "Ticket ##{ticket.id}: #{ticket.priority.name} priority", :class => "custom" } -%></td>
      <% end -%>
      <td><%=h truncate(ticket.title, :length => 40) %></td>
      <td><%= ticket.group.name %></td>
      <td><%= ticket.status.name %></td>
      <td><%= link_to ticket.contact.full_name, contact_path(ticket.contact.id) -%></td>
      <td><%= time_ago_in_words ticket.updated_at %></td>
    </tr>
    <% end %>
  </tbody>
  </table>
  </div>
<% end -%>

<% if (@current_user.id == @user.id or @current_user.admin?) and !@user.alerts.empty? -%>
  <h3 class="toggle" id="alerts-toggle"><%= t '.my_ticket_alerts' %></h3>
  <div id="alert-list">
    <ul>
      <% @user.alerts.each do |alert| -%>
      <li>
        <strong><%= link_to t( 'tickets.ticket_x', :number => alert.ticket.id ), ticket_path(alert.ticket_id) -%></strong> <%= t '.added_on' %> <%= nice_date alert.created_at unless alert.created_at.nil? -%>
        <span><%= link_to t( 'delete' ), { :action=> 'destroy', :controller => 'alerts', :id => alert.id }, :method => :delete, :confirm => t( '.really_delete_alert_for_ticket_x', :number => alert.ticket.id ) -%></span>
      </li>
      <% end -%>
    </ul>
  </div>
<% end -%>
